"use strict";var U=Object.create;var d=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var C=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,D=Object.prototype.hasOwnProperty;var T=(t,e)=>{for(var r in e)d(t,r,{get:e[r],enumerable:!0})},y=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of C(e))!D.call(t,n)&&n!==r&&d(t,n,{get:()=>e[n],enumerable:!(o=O(e,n))||o.enumerable});return t};var k=(t,e,r)=>(r=t!=null?U(x(t)):{},y(e||!t||!t.__esModule?d(r,"default",{value:t,enumerable:!0}):r,t)),P=t=>y(d({},"__esModule",{value:!0}),t);var q={};T(q,{OAuthErrorCode:()=>R,OAuthExtension:()=>f,OAuthPayloadMethods:()=>g});module.exports=P(q);var w=require("@magic-sdk/commons");var g=(e=>(e.ParseRedirectResult="magic_oauth_parse_redirect_result",e))(g||{}),R=(i=>(i.InvalidRequest="invalid_request",i.InvalidClient="invalid_client",i.InvalidScope="invalid_scope",i.InvalidGrant="invalid_grant",i.UnauthorizedClient="unauthorized_client",i.UnsupportedResponseType="unsupported_response_type",i.UnsupportedGrantType="unsupported_grant_type",i.UnsupportedTokenType="unsupported_token_type",i.AccessDenied="access_denied",i.ServerError="server_error",i.TemporarilyUnavailable="temporarily_unavailable",i))(R||{});var m=k(require("crypto-js")),v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",A=typeof window<"u"&&!!window.crypto,S=A&&!!window.crypto.subtle;function E(t){return Array.from(t).map(e=>v[e%v.length]).join("")}function _(t){let e=r=>r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(t instanceof ArrayBuffer){let r=new Uint8Array(t),o=Array.from(r).map(a=>String.fromCharCode(a)).join(""),n=btoa(o);return e(n)}return e(m.default.enc.Base64.stringify(t))}async function $(t){if(S){let e=new TextEncoder().encode(t);return crypto.subtle.digest("SHA-256",e).then(_)}return _(m.default.SHA256(t))}function b(t){let e=new Uint8Array(t);if(A)window.crypto.getRandomValues(e);else for(let r=0;r<t;r+=1)e[r]=Math.floor(Math.random()*Math.floor(255));return E(e)}async function I(){let t=b(128),e=b(128),r=await $(e);return{verifier:e,challenge:r,state:t}}var f=class extends w.Extension.Internal{name="oauth";config={};compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1,"@magic-sdk/react-native-bare":!1,"@magic-sdk/react-native-expo":!1};loginWithRedirect(e){return this.utils.createPromiEvent(async r=>{let{provider:o,query:n}=await H.call(this,e);window.location.href=new URL(`/v1/oauth2/${o}/start?${n}`,this.sdk.endpoint).href,r()})}getRedirectResult(e){let r=window.location.search,o=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",o),M.call(this,r,e)}},p="oauth_redirect_metadata";async function H(t){await this.utils.storage.removeItem(p);let{provider:e,redirectURI:r,scope:o,loginHint:n}=t,{verifier:a,challenge:l,state:c}=await I(),u=JSON.stringify({verifier:a,state:c});return await this.utils.storage.setItem(p,u),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(l)}`,`state=${encodeURIComponent(c)}`,`platform=${encodeURIComponent("web")}`,o&&`scope=${encodeURIComponent(o.join(" "))}`,r&&`redirect_uri=${encodeURIComponent(r)}`,n&&`login_hint=${encodeURIComponent(n)}`].reduce((s,i)=>i?`${s}&${i}`:s),provider:e,redirectURI:r}}function M(t,e){return this.utils.createPromiEvent(async(r,o)=>{let n=await this.utils.storage.getItem(p),{verifier:a,state:l}=JSON.parse(n);this.utils.storage.removeItem(p);let c=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[t,a,l,e]),u=await this.request(c),h=u,s=u;s.error&&o(this.createError(s.error,s.error_description??"An error occurred.",{errorURI:s.error_uri,provider:s.provider})),r(h)})}
//# sourceMappingURL=index.js.map
