import{Extension as U}from"@magic-sdk/commons";var g=(e=>(e.ParseRedirectResult="magic_oauth_parse_redirect_result",e))(g||{}),b=(n=>(n.InvalidRequest="invalid_request",n.InvalidClient="invalid_client",n.InvalidScope="invalid_scope",n.InvalidGrant="invalid_grant",n.UnauthorizedClient="unauthorized_client",n.UnsupportedResponseType="unsupported_response_type",n.UnsupportedGrantType="unsupported_grant_type",n.UnsupportedTokenType="unsupported_token_type",n.AccessDenied="access_denied",n.ServerError="server_error",n.TemporarilyUnavailable="temporarily_unavailable",n))(b||{});import y from"crypto-js";var m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",R=typeof window<"u"&&!!window.crypto,A=R&&!!window.crypto.subtle;function I(r){return Array.from(r).map(e=>m[e%m.length]).join("")}function f(r){let e=t=>t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"");if(r instanceof ArrayBuffer){let t=new Uint8Array(r),i=Array.from(t).map(a=>String.fromCharCode(a)).join(""),o=btoa(i);return e(o)}return e(y.enc.Base64.stringify(r))}async function w(r){if(A){let e=new TextEncoder().encode(r);return crypto.subtle.digest("SHA-256",e).then(f)}return f(y.SHA256(r))}function h(r){let e=new Uint8Array(r);if(R)window.crypto.getRandomValues(e);else for(let t=0;t<r;t+=1)e[t]=Math.floor(Math.random()*Math.floor(255));return I(e)}async function v(){let r=h(128),e=h(128),t=await w(e);return{verifier:e,challenge:t,state:r}}var _=class extends U.Internal{name="oauth";config={};compat={"magic-sdk":">=2.4.6","@magic-sdk/react-native":!1,"@magic-sdk/react-native-bare":!1,"@magic-sdk/react-native-expo":!1};loginWithRedirect(e){return this.utils.createPromiEvent(async t=>{let{provider:i,query:o}=await O.call(this,e);window.location.href=new URL(`/v1/oauth2/${i}/start?${o}`,this.sdk.endpoint).href,t()})}getRedirectResult(e){let t=window.location.search,i=window.location.origin+window.location.pathname;return window.history.replaceState(null,"",i),C.call(this,t,e)}},d="oauth_redirect_metadata";async function O(r){await this.utils.storage.removeItem(d);let{provider:e,redirectURI:t,scope:i,loginHint:o}=r,{verifier:a,challenge:p,state:c}=await v(),u=JSON.stringify({verifier:a,state:c});return await this.utils.storage.setItem(d,u),{query:[`magic_api_key=${encodeURIComponent(this.sdk.apiKey)}`,`magic_challenge=${encodeURIComponent(p)}`,`state=${encodeURIComponent(c)}`,`platform=${encodeURIComponent("web")}`,i&&`scope=${encodeURIComponent(i.join(" "))}`,t&&`redirect_uri=${encodeURIComponent(t)}`,o&&`login_hint=${encodeURIComponent(o)}`].reduce((s,n)=>n?`${s}&${n}`:s),provider:e,redirectURI:t}}function C(r,e){return this.utils.createPromiEvent(async(t,i)=>{let o=await this.utils.storage.getItem(d),{verifier:a,state:p}=JSON.parse(o);this.utils.storage.removeItem(d);let c=this.utils.createJsonRpcRequestPayload("magic_oauth_parse_redirect_result",[r,a,p,e]),u=await this.request(c),l=u,s=u;s.error&&i(this.createError(s.error,s.error_description??"An error occurred.",{errorURI:s.error_uri,provider:s.provider})),t(l)})}export{b as OAuthErrorCode,_ as OAuthExtension,g as OAuthPayloadMethods};
//# sourceMappingURL=index.mjs.map
